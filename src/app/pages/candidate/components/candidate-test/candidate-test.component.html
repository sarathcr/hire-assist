<!-- eslint-disable @angular-eslint/template/label-has-associated-control -->
<div class="assessment">
  <div class="assessment__carousel">
    @if (data.questions) {
      <p-carousel
        [value]="data.questions"
        [numVisible]="25"
        [numScroll]="5"
        [circular]="false"
        [responsiveOptions]="responsiveOptions"
      >
        <ng-template let-quest pTemplate="item">
          <app-button
            class="btn"
            [buttonConfig]="quest"
            [btnRounded]="true"
            [buttonSeverity]="
              quest.status === 'reviewed'
                ? 'warn'
                : quest.status === 'skipped'
                  ? 'danger'
                  : quest.status === 'saved'
                    ? 'success'
                    : quest.id === activeButtonId
                      ? 'info'
                      : 'secondary'
            "
            buttonLabel="{{ data.questions.indexOf(quest) + 1 }}"
            (btnClick)="onButtonClick(quest.id)"
            >{{ activeButtonId }}
          </app-button>
        </ng-template>
      </p-carousel>
    }
  </div>

  <div class="assessment__header-wrapper">
    <p class="assessment__title">
      Question
      {{ data.questions ? data.questions.indexOf(activeQuestion) + 1 : "" }}
    </p>
    <div class="assessment__header_end">
      <app-timer></app-timer
      ><span
        class="assessment__info pi pi-info-circle"
        [pTooltip]="tooltipContent"
        tooltipPosition="bottom"
      ></span>

      <ng-template #tooltipContent>
        <div class="assessment__tooltip">
          <ul class="assessment__tooltip-list">
            <li class="assessment__tooltip-list-item">
              <span
                class="assessment__tooltip-item assessment__tooltip-item_active"
              ></span
              ><span class="assessment__tooltip-text">Active</span>
            </li>
            <li class="assessment__tooltip-list-item">
              <span
                class="assessment__tooltip-item assessment__tooltip-item_skip"
              ></span
              ><span class="assessment__tooltip-text">Skipped</span>
            </li>
            <li class="assessment__tooltip-list-item">
              <span
                class="assessment__tooltip-item assessment__tooltip-item_review"
              ></span
              ><span class="assessment__tooltip-text">Marked as review</span>
            </li>
            <li class="assessment__tooltip-list-item">
              <span
                class="assessment__tooltip-item assessment__tooltip-item_complete"
              ></span
              ><span class="assessment__tooltip-text">Completed</span>
            </li>
            <li class="assessment__tooltip-list-item">
              <span
                class="assessment__tooltip-item assessment__tooltip-item_unattended"
              ></span
              ><span class="assessment__tooltip-text">Unattended</span>
            </li>
          </ul>
        </div>
      </ng-template>
    </div>
  </div>

  @if (activeQuestion) {
    <div class="assessment__question">
      <app-question [question]="activeQuestion"> </app-question>
      @if (activeQuestion.isMultipleChoice === true) {
        <div class="assessment__checkbox-group">
          @for (option of activeQuestion.option; track option.id) {
            <div class="assessment__checkbox-item">
              <p-checkbox
                [value]="option.id"
                [(ngModel)]="selectedValues[activeQuestion.id]"
                variant="filled"
                (checked)="(selectedValues[activeQuestion.id])"
                (onChange)="onCheckboxChange($event, activeQuestion.id)"
              >
                <!-- onOptionSelect(activeQuestion.id, $event) -->
              </p-checkbox>
              <label>{{ option.optionText }}</label>
            </div>
          }
        </div>
      } @else {
        @for (item of activeQuestion.option; track item.id) {
          <app-input-radio
            [option]="item"
            [(selectedValue)]="selectedValues[activeQuestion.id]"
            [groupName]="'question_' + activeQuestion.id"
            (selectedValueChange)="onOptionSelect(activeQuestion.id, $event)"
          >
          </app-input-radio>
        }
      }
    </div>
  }

  <div class="assessment__actionButtons">
    <div class="assessment__actionButtons_review-skip-button">
      <app-button
        [buttonLabel]="'Mark as Review'"
        [buttonVariant]="'outlined'"
        (btnClick)="onReviewBtnClick()"
      ></app-button>
      <app-button
        [buttonLabel]="'Skip'"
        [buttonVariant]="'outlined'"
        (btnClick)="onSkipBtnClick()"
      ></app-button>
    </div>
    <div class="save-button">
      @if (data.questions) {
        @if (
          data.questions.indexOf(activeQuestion) + 1 === data.questions.length
        ) {
          <app-button
            [buttonLabel]="'Finish'"
            [disabled]="!selectedValues[activeQuestion?.id]"
            (btnClick)="onFinishBtnClick()"
          ></app-button>
        } @else {
          <app-button
            [buttonLabel]="'Save & Next'"
            [disabled]="!selectedValues[activeQuestion?.id]"
            (btnClick)="onSaveBtnClick()"
          ></app-button>
        }
      }
    </div>
  </div>
</div>
